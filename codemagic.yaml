definitions:
  environment_versions: &hello_environment_versions
    xcode: 13.3
    vars:
      XCODE_PROJECT: "HELLO WORLD.xcodeproj"
      XCODE_iOS_SCHEME: "HELLO WORLD"

workflows:
  ios-testing-workflow:
    name: iOS Testing Workflow
    instance_type: mac_mini
    environment:
      <<: *hello_environment_versions
    scripts:
      - |
        #! /bin/zsh  
        SIMULATOR_NAME="my-sim"
  
        # Create Simulator
        SIMULATOR_UDID=`xcrun simctl create "$SIMULATOR_NAME" com.apple.CoreSimulator.SimDeviceType.iPhone-13 com.apple.CoreSimulator.SimRuntime.iOS-15-4`
 
        # Run Simulator
        xcrun simctl boot $SIMULATOR_UDID
      - sleep 15
      - name: TESTING
        script: |
          xcode-project run-tests \
            --project "$XCODE_PROJECT" \
            --scheme "$XCODE_iOS_SCHEME" \
            --device "iPhone 13"
        test_report: build/ios/test/*.xml
